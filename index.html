<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Anime Buzz</title>
    <style>
        :root { --primary-red: #E50914; --background-color: #141414; --text-color: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: var(--background-color); 
            color: var(--text-color);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background-image 0.5s ease-in-out;
        }
        #loader-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--background-color); display: flex; align-items: center;
            justify-content: center; z-index: 9999; padding: 20px;
        }
        .name-entry-box { text-align: center; width: 100%; max-width: 400px; }
        .name-entry-box h2 { margin-bottom: 25px; font-size: 22px; font-weight: 600; }
        
        .loader-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-red);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #app-wrapper { display: none; }
        .page { display: none; padding-bottom: 70px; }
        .page.active { display: block; }

        #main-header, #secondary-header { padding: 15px 20px; }
        #secondary-header { display: none; }
        .header-content { display: flex; align-items: center; justify-content: space-between; }
        .logo-group { display: flex; align-items: center; }
        .logo-placeholder { width: 35px; height: 35px; border-radius: 6px; margin-right: 15px; background-image: url('https://i.postimg.cc/gjS2LNtp/d036b4adf7918cd38c1b8f06523b7580.jpg'); background-size: cover; background-position: center; }
        .website-name { font-size: 26px; font-weight: 900; }
        .website-name span { color: var(--primary-red); }
        .details-title-group { display: flex; align-items: baseline; gap: 8px; flex-wrap: wrap; }
        .uploader-name { font-size: 13px; color: #ccc; font-weight: 400; }
        .details-header-icons { display: flex; align-items: center; gap: 20px; }
        .save-icon { width: 30px; height: 30px; cursor: pointer; }
        .save-icon path { fill: none; stroke: var(--text-color); stroke-width: 1.5; }
        .save-icon.saved path { fill: var(--primary-red); stroke: var(--primary-red); }
        .back-btn { display: inline-block; color: var(--text-color); text-decoration: none; font-size: 18px; padding: 20px 20px 0 20px; }
        .back-btn:before { content: '‹ '; font-size: 24px; }
        .slider-container { position: relative; width: 100%; aspect-ratio: 16 / 9; max-height: 768px; margin-bottom: 25px; overflow: hidden; background-color: #000; }
        .slider-track { position: relative; height: 100%; display: flex; }
        .hero-slide { position: relative; width: 100%; height: 100%; flex-shrink: 0; background-size: cover; background-position: center; display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-start; padding: 30px; cursor: grab; }
        .hero-slide::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(20, 20, 20, 0.9), transparent); }
        .hero-title { z-index: 2; font-size: 22px; font-weight: bold; text-shadow: 2px 2px 4px #000; text-align: left; }
        .watch-now-btn { z-index: 2; margin-top: 15px; padding: 10px 25px; background-color: var(--primary-red); color: var(--text-color); border: none; border-radius: 4px; font-size: 14px; font-weight: bold; display: inline-flex; align-items: center; gap: 25px; cursor: pointer; text-transform: uppercase; }
        .anime-row { margin-bottom: 20px; }
        .anime-row h2 { font-size: 18px; margin-bottom: 12px; padding: 0 20px; }
        .row-content { display: flex; overflow-x: auto; gap: 12px; padding: 0 20px 10px 20px; scrollbar-width: none; min-height: 185px; }
        .row-content::-webkit-scrollbar { display: none; }
        .anime-card { flex-shrink: 0; width: 110px; cursor: pointer; }
        .anime-card-poster { position: relative; width: 100%; height: 155px; }
        .anime-card img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; background-color: #333; }
        .language-tag { position: absolute; top: 6px; right: 6px; background-color: rgba(20, 20, 20, 0.8); padding: 3px 7px; border-radius: 4px; font-size: 11px; font-weight: bold; }
        .anime-card p { margin-top: 8px; font-size: 13px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #search-page .search-bar-container { padding: 15px 20px 25px 20px; }
        .search-input { width: 100%; padding: 14px 20px; background-color: #2c2c2c; border: 1px solid var(--primary-red); border-radius: 25px; color: var(--text-color); font-size: 16px; }
        #no-results { text-align: center; padding: 50px 20px; color: #888; }
        #search-results-wrapper, #saved-items-list { padding: 0 20px; }
        .search-result-item { display: flex; align-items: flex-start; margin-bottom: 20px; cursor: default; }
        .search-item-poster { position: relative; width: 100px; height: 145px; flex-shrink: 0; cursor: pointer; }
        .search-item-poster img { width: 100%; height: 100%; object-fit: cover; border-radius: 6px; background-color: #333;}
        .search-item-info { padding-left: 15px; flex-grow: 1; }
        .search-item-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px; }
        .search-item-title { font-size: 17px; font-weight: bold; cursor: pointer; }
        .rating-display { display: flex; align-items: center; gap: 5px; font-size: 14px; color: #f5c518; font-weight: bold; flex-shrink: 0; margin-left: 10px; }
        .search-item-desc { font-size: 13px; color: #ccc; line-height: 1.5; margin-bottom: 12px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .list-download-btn { padding: 8px 16px; background-color: var(--primary-red); color: var(--text-color); border: none; border-radius: 6px; font-size: 14px; font-weight: bold; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
        .details-content-wrapper { padding: 20px; }
        .details-poster-container { max-width: 200px; margin: 0 auto 20px auto; }
        .details-poster { width: 100%; border-radius: 10px; background-color: #333;}
        .details-info h1 { font-size: 28px; }
        .details-info p { margin-top: 10px; color: #ccc; line-height: 1.5; }
        .action-button-container { margin-top: 25px; }
        .watch-btn { display: block; width: 100%; padding: 12px 25px; background-color: var(--primary-red); color: var(--text-color); border: none; border-radius: 5px; font-size: 16px; font-weight: bold; text-align: center; cursor: pointer; }
        .download-btn-container { padding: 30px 20px; text-align: center; }
        .download-btn { display: inline-block; width: 100%; max-width: 350px; padding: 15px 25px; background-color: var(--primary-red); color: var(--text-color); border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background-color: #181818; display: flex; justify-content: space-around; padding: 8px 0; border-top: 1px solid #333; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #8e8e8e; text-decoration: none; font-size: 12px; cursor: pointer; flex: 1; text-align: center; }
        .nav-item.active { color: var(--text-color); }
        .nav-icon { width: 26px; height: 26px; margin-bottom: 3px; }
        .nav-icon path { fill: currentColor; }
        .name-input { width: 100%; max-width: 350px; padding: 14px 20px; background-color: #2c2c2c; border: 1px solid #555; border-radius: 8px; color: var(--text-color); font-size: 16px; margin: 0 auto 20px auto; display: block; box-sizing: border-box; }
        .name-input:focus { outline: none; border-color: var(--primary-red); box-shadow: 0 0 10px rgba(229, 9, 20, 0.5); }
        .enter-btn { display: inline-block; width: 100%; max-width: 350px; padding: 14px 25px; background-color: var(--primary-red); color: var(--text-color); border: none; border-radius: 8px; font-size: 17px; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        #update-list-container { padding: 20px; }
        .update-card { background-color: #2a2a2a; border-radius: 10px; margin-bottom: 20px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.2); cursor: pointer; }
        .update-banner { width: 100%; aspect-ratio: 16 / 9; object-fit: cover; background-color: #333; }
        .update-description { padding: 15px; font-size: 14px; line-height: 1.6; }
        @media (min-width: 768px) {
            .row-content { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 20px; overflow-x: hidden; }
            .anime-card { width: auto; }
            #search-results-wrapper, #saved-items-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
            .search-result-item { max-width: 100%; }
            #update-list-container { max-width: 800px; margin: 0 auto; }
        }
    </style>
</head>
<body>
    <div id="loader-container">
        <div class="name-entry-box" id="name-box" style="display: none;">
            <h2>Enter Your Name to Continue</h2>
            <input type="text" id="initialNameInput" class="name-input" placeholder="Your Name">
            <button class="enter-btn" onclick="submitInitialName()">Enter Anime Buzz</button>
        </div>
        <div id="loader-text">
            <div class="loader-spinner"></div>
        </div>
    </div>

    <div id="app-wrapper">
        <header id="main-header"><div class="header-content"><div class="logo-group"><div class="logo-placeholder"></div><h1 class="website-name">Anime<span>Buzz</span></h1></div></div></header>
        <header id="secondary-header"><div class="header-content" id="secondary-header-content"></div></header>
        <div id="home-page" class="page active"><main><section id="banner-container" class="slider-container"><div id="slider-track" class="slider-track"></div></section><div id="home-rows"></div></main></div>
        <div id="search-page" class="page"><div class="search-bar-container"><input type="text" id="searchInput" class="search-input" placeholder="Search..." onkeyup="handleSearch()"></div><div id="search-results-wrapper"></div></div>
        <div id="saved-page" class="page"><div id="saved-items-list"></div></div>
        <div id="update-page" class="page"><div id="update-list-container"></div></div>

        <div id="details-page" class="page"><a href="#" class="back-btn" onclick="event.preventDefault(); navigateBack()">Back</a><div class="details-content-wrapper"><div class="details-poster-container"><img src="" id="details-poster" class="details-poster" loading="lazy" decoding="async"></div><div class="details-info"><h1 id="details-title"></h1><p id="details-desc"></p></div><div class="action-button-container"><button id="details-watch-btn" class="watch-btn" onclick="navigateTo('episodes-page')">Watch Now</button></div></div></div>
        <div id="episodes-page" class="page"><a href="#" class="back-btn" onclick="event.preventDefault(); navigateTo('details-page')">Back</a><div id="episodes-container"></div></div>
        
        <div id="update-details-page" class="page">
            <a href="#" class="back-btn" onclick="event.preventDefault(); navigateBack()">Back</a>
            <div class="details-content-wrapper">
                <h1 id="update-details-title" style="margin-bottom: 15px;"></h1>
                <p id="update-details-desc" style="white-space: pre-wrap; line-height: 1.7;"></p>
            </div>
        </div>

        <nav class="bottom-nav">
            <a id="nav-home" class="nav-item active" onclick="navigateTo('home-page')"><svg class="nav-icon" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg><span>Home</span></a>
            <a id="nav-search" class="nav-item" onclick="navigateTo('search-page')"><svg class="nav-icon" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"></path></svg><span>Search</span></a>
            <a id="nav-saved" class="nav-item" onclick="navigateTo('saved-page')"><svg class="nav-icon" viewBox="0 0 20 20"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path></svg><span>Saved</span></a>
            <a id="nav-update" class="nav-item" onclick="navigateTo('update-page')"><svg class="nav-icon" viewBox="0 0 20 20"><path d="M10 2a6 6 0 00-6 6v3.586l-1.707-1.707A1 1 0 00.879 11.293l-1.293 1.293a1 1 0 000 1.414l5 5a1 1 0 001.414 0l5-5a1 1 0 000-1.414l-1.293-1.293a1 1 0 00-1.414-.293L10 11.586V8a4 4 0 118 0v1a1 1 0 102 0V8a6 6 0 00-6-6z"></path></svg><span>Update</span></a>
        </nav>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyASOG_iJLTolJHK54Z4BpLpAimA4JALURY",
          authDomain: "animeweb-b9a7b.firebaseapp.com",
          projectId: "animeweb-b9a7b",
          storageBucket: "animeweb-b9a7b.firebasestorage.app",
          messagingSenderId: "920902736319",
          appId: "1:920902736319:web:b0dff9ec9e298021bf290a"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let pageHistory = ['home-page'], savedItems = [], allData = { anime: [], animeBanners: [] }, currentItemData = null, userName = null, sliderInitialized = false;
        let isAppReady = false;
        let initialDataRendered = { banners: false, anime: false };
        let fullAnimeListLoaded = false; 

        // ===== INFINITE SCROLL KE LIYE NAYE VARIABLES =====
        let lastVisibleAnime = null; // Aakhri dikhne wala anime
        let isLoadingMore = false; // Check karega ki data load ho raha hai ya nahi

        function revealApp() {
            document.getElementById('loader-container').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'block';
        }

        function checkInitialRenderComplete() {
            if (initialDataRendered.banners && initialDataRendered.anime) {
                isAppReady = true;
                if (userName) {
                    revealApp();
                } else {
                    document.getElementById('loader-text').style.display = 'none';
                    document.getElementById('name-box').style.display = 'block';
                }
            }
        }

        async function submitInitialName() {
            const nameInput = document.getElementById('initialNameInput');
            const enteredName = nameInput.value.trim();
            if (enteredName !== '') {
                userName = enteredName;
                localStorage.setItem('animeBuzzUserName', enteredName);
                try {
                    await db.collection('users').add({
                        name: enteredName,
                        status: 'active',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (err) { console.error("Error saving user to Firestore:", err); }

                if (isAppReady) {
                    revealApp();
                } else {
                    document.getElementById('name-box').style.display = 'none';
                    document.getElementById('loader-text').style.display = 'block';
                }
            } else { alert('Please enter your name.'); }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            userName = localStorage.getItem('animeBuzzUserName');
            initializeApp();

            // ===== INFINITE SCROLL KE LIYE EVENT LISTENER =====
            window.addEventListener('scroll', () => {
                // Agar user home page par hai, neeche tak scroll kar chuka hai, aur data load nahi ho raha hai
                if (document.getElementById('home-page').classList.contains('active') && 
                    (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200 && 
                    !isLoadingMore) {
                    loadMoreAnime();
                }
            });

            document.body.addEventListener('click', (event) => { 
                const clickableItem = event.target.closest('.search-item-poster, .search-item-title, .anime-card, .update-card'); 
                if (clickableItem && clickableItem.dataset.details) { 
                    try { 
                        const details = JSON.parse(clickableItem.dataset.details.replace(/&apos;/g, "'")); 
                        if (details.type === 'update') {
                            navigateTo('update-details-page', details);
                        } else {
                            navigateTo('details-page', details); 
                        }
                    } catch (e) { console.error("Failed to parse data-details JSON:", e); } 
                } 
            });
            const sliderTrack = document.getElementById('slider-track');
            if(sliderTrack) { sliderTrack.addEventListener('click', (event) => { const watchButton = event.target.closest('.watch-now-btn'); if (watchButton && watchButton.dataset.details) { try { const details = JSON.parse(watchButton.dataset.details.replace(/&apos;/g, "'")); navigateTo('details-page', details); } catch (e) { console.error("Failed to parse banner button data-details JSON:", e); } } }); }
        });

        function initializeApp() {
            try {
                db.collection('siteConfig').doc('main').onSnapshot(doc => {
                    if (doc.exists) {
                        const config = doc.data();
                        applyPrimaryColor(config.primaryColor);
                        applyBackground(config.backgroundUrl);
                        applyWebsiteName(config.websiteName);
                    }
                }, err => console.error("Error fetching site config:", err));

                // Shuru mein sirf 40 anime load honge
                db.collection('anime').orderBy("title").limit(40).onSnapshot(snapshot => {
                    const docs = snapshot.docs;
                    lastVisibleAnime = docs[docs.length - 1]; // Aakhri anime ko save kar lo
                    
                    const initialAnime = docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    if (!fullAnimeListLoaded) {
                        allData.anime = initialAnime;
                    }
                    renderHomePage(allData.anime);
                    
                    if (!initialDataRendered.anime) {
                        initialDataRendered.anime = true;
                        checkInitialRenderComplete();
                    }
                }, err => console.error("Error fetching anime:", err));

                db.collection('animeBanners').onSnapshot(snapshot => {
                    allData.animeBanners = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderBanners(allData.animeBanners);
                    if (!initialDataRendered.banners) {
                        initialDataRendered.banners = true;
                        checkInitialRenderComplete();
                    }
                }, err => console.error("Error fetching banners:", err));
                
                setupRealtimeListeners();
            } catch (err) {
                console.error("Error initializing app:", err);
                document.getElementById('loader-text').innerHTML = "<p>Failed to load data. Please refresh.</p>";
            }
        }

        // ===== INFINITE SCROLL KE LIYE NAYA FUNCTION =====
        async function loadMoreAnime() {
            if (isLoadingMore || !lastVisibleAnime) return; // Agar data load ho raha hai ya aakhri anime nahi hai, to kuch na karo
            isLoadingMore = true; // Loading shuru

            try {
                const snapshot = await db.collection('anime')
                    .orderBy("title")
                    .startAfter(lastVisibleAnime) // Aakhri anime se aage shuru karo
                    .limit(20) // Agle 20 anime lao
                    .get();

                const docs = snapshot.docs;
                if (docs.length > 0) {
                    lastVisibleAnime = docs[docs.length - 1]; // Naye aakhri anime ko save karo
                    const newAnime = docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    allData.anime = [...allData.anime, ...newAnime]; // Naye anime ko purani list mein jodo
                    renderHomePage(allData.anime); // Poori list ko dobara render karo
                }
            } catch (err) {
                console.error("Error loading more anime:", err);
            }
            isLoadingMore = false; // Loading khatm
        }

        async function fetchAllAnimeForSearch() {
            if (fullAnimeListLoaded) return;
            try {
                const snapshot = await db.collection('anime').orderBy("title").get();
                allData.anime = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                fullAnimeListLoaded = true;
                handleSearch(true);
            } catch (err) {
                console.error("Error fetching full anime list for search:", err);
            }
        }
        
        function setupRealtimeListeners() {
            db.collection('updates').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                const updates = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderUpdates(updates);
            }, err => console.error("Error fetching updates:", err));
        }
        
        function navigateTo(pageId, data = null) { 
            if (pageHistory[pageHistory.length - 1] !== pageId || data) { 
                if (pageHistory[pageHistory.length - 1] !== pageId) pageHistory.push(pageId); 
            } 
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); 
            document.getElementById(pageId)?.classList.add('active'); 
            
            if (pageId === 'details-page' && data) { currentItemData = data; document.getElementById('details-poster').src = data.imageUrl; document.getElementById('details-title').innerText = data.title; document.getElementById('details-desc').innerText = data.description || 'No description available.'; document.getElementById('details-watch-btn').innerText = data.buttonText || 'Watch Now'; } 
            if (pageId === 'update-details-page' && data) { document.getElementById('update-details-title').innerText = data.title || 'Update Details'; document.getElementById('update-details-desc').innerText = data.description || 'No description available.'; }
            if (pageId === 'episodes-page') renderDownloadPage(); 
            if (pageId === 'saved-page') renderSavedItems(); 
            
            if (pageId === 'search-page') {
                if (!fullAnimeListLoaded) {
                    fetchAllAnimeForSearch();
                } else {
                    handleSearch(true);
                }
            } 
            updateHeader(pageId); 
            window.scrollTo(0, 0); 
        }

        // (The rest of the JS functions are omitted for brevity as they are unchanged)
        function createSearchResultItem(item) { const safeDetails = JSON.stringify({...item, type: 'anime'}).replace(/'/g, '&apos;'); const ratingHtml = item.rating ? `<div class="rating-display">⭐ ${item.rating}</div>` : ''; const episodeLink = item.episodeLink ? item.episodeLink.replace(/'/g, "\\'") : ''; const downloadBtnHtml = item.episodeLink ? `<button class="list-download-btn" onclick="openExternalLink('${episodeLink}')">Download</button>` : ''; return ` <div class="search-result-item" data-details='${safeDetails}'> <div class="search-item-poster" data-details='${safeDetails}'> <img loading="lazy" decoding="async" width="100" height="145" src="${item.imageUrl}" alt="${item.title}"> ${item.language ? `<span class="language-tag">${item.language}</span>` : ''} </div> <div class="search-item-info"> <div class="search-item-header"> <div class="search-item-title" data-details='${safeDetails}'>${item.title}</div> ${ratingHtml} </div> <div class="search-item-desc">${item.description || 'No description available.'}</div> ${downloadBtnHtml} </div> </div>`; }
        function updateHeader(pageId) { const pageHeaders = { "search-page": "Search", "saved-page": "My List", "update-page": "Latest Updates", "details-page": "Details", "episodes-page": "Episodes", "update-details-page": "Update" }; const title = pageHeaders[pageId]; const mainHeader = document.getElementById("main-header"); const secondaryHeader = document.getElementById("secondary-header"); const headerContentEl = document.getElementById("secondary-header-content"); if (title) { mainHeader.style.display = "none"; secondaryHeader.style.display = "block"; let headerContent = ''; if ("details-page" === pageId && currentItemData) { let titleHtml = `<h1 class="website-name">${title}</h1>`; if (currentItemData.uploadedBy) { titleHtml = `<div class="details-title-group">${titleHtml}<span class="uploader-name">by ${currentItemData.uploadedBy}</span></div>`; } headerContent = titleHtml; if (currentItemData.type === 'anime') { const safeTitle = currentItemData.title ? currentItemData.title.replace(/'/g, "\\'") : ''; let iconsHtml = `<svg class="save-icon ${savedItems.some(i => i.id === currentItemData.id) ? "saved" : ""}" onclick="toggleSave(this, '${currentItemData.id}', '${safeTitle}', '${currentItemData.imageUrl}')" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`; headerContent += `<div class="details-header-icons">${iconsHtml}</div>`; } } else { headerContent = `<h1 class="website-name">${title}</h1>`; } headerContentEl.innerHTML = headerContent; } else { mainHeader.style.display = "block"; secondaryHeader.style.display = "none"; } document.querySelectorAll(".nav-item").forEach(item => item.classList.remove("active")); document.getElementById(`nav-${pageId.split("-")[0]}`)?.classList.add("active"); }
        function createAnimeCard(item) { const langTag = item.language ? `<span class="language-tag">${item.language}</span>` : ''; const safeDetails = JSON.stringify({...item, type: 'anime'}).replace(/'/g, '&apos;');  return `<div class="anime-card" data-details='${safeDetails}'><div class="anime-card-poster"><img loading="lazy" decoding="async" width="110" height="155" src="${item.imageUrl}" alt="${item.title}"> ${langTag}</div><p>${item.title}</p></div>`; }
        function applyPrimaryColor(color) { if (color) { document.documentElement.style.setProperty('--primary-red', color); } }
        function applyBackground(url) { if (url) { document.body.style.backgroundImage = `url('${url}')`; } }
        function applyWebsiteName(name) { if (name) { const nameElement = document.querySelector('#main-header .website-name'); if (nameElement) { nameElement.innerHTML = `${name}<span>Buzz</span>`; } } }
        function renderUpdates(updatesList) { const container = document.getElementById('update-list-container'); if (!container) return; if (updatesList.length === 0) { container.innerHTML = `<div id="no-results"><p>No updates available right now.</p></div>`; return; } container.innerHTML = updatesList.map(update => { const safeDetails = JSON.stringify({...update, type: 'update'}).replace(/'/g, '&apos;'); return `<div class="update-card" data-details='${safeDetails}'> <img src="${update.bannerUrl}" alt="Update Banner" class="update-banner" loading="lazy" decoding="async"> <div class="update-description"> <p>${update.description ? update.description.replace(/\n/g, '<br>') : 'No description.'}</p> </div> </div>`; }).join(''); }
        function renderBanners(banners) { const track = document.getElementById('slider-track'); if (!track) return; if (banners.length === 0) { track.innerHTML = ""; return; } track.innerHTML = banners.map(banner => { const bannerData = { ...banner, type: 'banner', id: banner.id || banner.title.replace(/\s+/g, '-') }; const styleAttribute = banner.imageUrl ? `style="background-image: url('${banner.imageUrl}');"` : ''; const safeDetails = JSON.stringify(bannerData).replace(/'/g, '&apos;'); return `<div class="hero-slide" ${styleAttribute}><h3 class="hero-title">${banner.title}</h3><button class="watch-now-btn" data-details='${safeDetails}'><span>${banner.buttonText || 'Watch Now'}</span><span>&gt;</span></button></div>`; }).join(''); if (!sliderInitialized) { initSlider(); sliderInitialized = true; } }
        function renderHomePage(animeList) { const container = document.getElementById("home-rows"); if (!container) return; savedItems = JSON.parse(localStorage.getItem('animeBuzzSaved')) || []; const categories = animeList.reduce((acc, anime) => { (acc[anime.category || "Trending"] = acc[anime.category || "Trending"] || []).push(anime); return acc; }, {}); container.innerHTML = Object.entries(categories).map(([category, items]) => `<section class="anime-row"><h2>${category}</h2><div class="row-content">${items.map(createAnimeCard).join('')}</div></section>`).join(''); }
        function handleSearch(showAll = false) { const term = document.getElementById("searchInput").value.toLowerCase(); const resultsWrapper = document.getElementById("search-results-wrapper"); const listToSearch = allData.anime; if (showAll && !term) { resultsWrapper.innerHTML = listToSearch.map(createSearchResultItem).join(''); return; } const filtered = listToSearch.filter(e => e.title.toLowerCase().includes(term)); resultsWrapper.innerHTML = filtered.length ? filtered.map(createSearchResultItem).join('') : `<div id="no-results"><p>No results found</p></div>`; }
        function renderDownloadPage() { const container = document.getElementById("episodes-container"); if (currentItemData && currentItemData.episodeLink) { container.innerHTML = `<div class="download-btn-container"><button class="download-btn" onclick="openExternalLink('${currentItemData.episodeLink}')">Download file</button></div>`; } else { container.innerHTML = '<p style="text-align: center; padding: 40px;">Download link not available.</p>'; } }
        function navigateBack() { if (pageHistory.length > 1) { pageHistory.pop(); navigateTo(pageHistory[pageHistory.length - 1]); } }
        function toggleSave(icon, id, title, imageUrl) { const isSaved = icon.classList.toggle("saved"); if (isSaved) { if (!savedItems.some(i => i.id === id)) savedItems.push({ id, title, imageUrl }); } else { savedItems = savedItems.filter(i => i.id !== id); } localStorage.setItem("animeBuzzSaved", JSON.stringify(savedItems)); }
        function renderSavedItems() { const listContainer = document.getElementById("saved-items-list"); if (savedItems.length > 0) { const fullItems = savedItems.map(item => allData.anime.find(a => a.id === item.id) || item); listContainer.innerHTML = fullItems.map(createSearchResultItem).join(''); } else { listContainer.innerHTML = `<div id="no-results"><p>Nothing saved yet.</p></div>`; } }
        function openExternalLink(url) { if (url && url.trim() !== '') { let fullUrl = url.trim(); if (!fullUrl.startsWith('http://') && !fullUrl.startsWith('https://')) { fullUrl = 'https://' + fullUrl; } window.open(fullUrl, '_blank'); } else { alert("Download link is not available."); } }
        function initSlider() { const container = document.getElementById('banner-container'); const track = document.getElementById('slider-track'); if (!container || !track) return; let slides = Array.from(track.children); if (slides.length <= 1) return; const slideCount = slides.length; const transitionTime = 400; const autoSlideInterval = 3000; track.style.setProperty('--transition-time', `${transitionTime}ms`); const firstClone = slides[0].cloneNode(true); firstClone.classList.add('clone'); const lastClone = slides[slideCount - 1].cloneNode(true); lastClone.classList.add('clone'); track.appendChild(firstClone); track.insertBefore(lastClone, slides[0]); let currentIndex = 1; let isDragging = false; let startPos = 0; let currentTranslate = 0; let prevTranslate = 0; let autoSlideTimer; function getPositionX(event) { return event.touches ? event.touches[0].clientX : event.pageX; } function setPositionByIndex() { currentTranslate = currentIndex * -container.offsetWidth; track.style.transform = `translateX(${currentTranslate}px)`; } function shiftSlides() { if (currentIndex <= 0) { track.style.transition = 'none'; currentIndex = slideCount; setPositionByIndex(); } else if (currentIndex >= slideCount + 1) { track.style.transition = 'none'; currentIndex = 1; setPositionByIndex(); } setTimeout(() => { track.style.transition = `transform ${transitionTime}ms ease-out`; }, 50); } function startAutoSlide() { clearInterval(autoSlideTimer); autoSlideTimer = setInterval(() => { currentIndex++; setPositionByIndex(); if (currentIndex >= slideCount + 1) { setTimeout(shiftSlides, transitionTime); } }, autoSlideInterval); } function dragStart(event) { clearInterval(autoSlideTimer); isDragging = true; startPos = getPositionX(event); prevTranslate = currentTranslate; track.style.transition = 'none'; } function dragMove(event) { if (isDragging) { const currentPosition = getPositionX(event); currentTranslate = prevTranslate + currentPosition - startPos; track.style.transform = `translateX(${currentTranslate}px)`; } } function dragEnd() { if (!isDragging) return; isDragging = false; const movedBy = currentTranslate - prevTranslate; if (movedBy < -100) currentIndex++; else if (movedBy > 100) currentIndex--; track.style.transition = `transform ${transitionTime}ms ease-out`; setPositionByIndex(); shiftSlides(); startAutoSlide(); } container.addEventListener('mousedown', dragStart); container.addEventListener('touchstart', dragStart, { passive: true }); container.addEventListener('mouseup', dragEnd); container.addEventListener('touchend', dragEnd); container.addEventListener('mouseleave', dragEnd); container.addEventListener('mousemove', dragMove); container.addEventListener('touchmove', dragMove, { passive: true }); window.addEventListener('resize', setPositionByIndex); track.style.transition = `transform ${transitionTime}ms ease-out`; setPositionByIndex(); startAutoSlide(); }
    </script>
</body>
    </html>
