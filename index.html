<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Anime Buzz</title>
    <style>
        :root { --primary-red: #E50914; --background-color: #141414; --text-color: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--background-color); color: var(--text-color); }
        .page { display: none; padding-bottom: 70px; }
        .page.active { display: block; }
        #main-header, #secondary-header { padding: 15px 20px; }
        #secondary-header { display: none; }
        .header-content { display: flex; align-items: center; justify-content: space-between; }
        .logo-group { display: flex; align-items: center; }
        .logo-placeholder { width: 35px; height: 35px; border-radius: 6px; margin-right: 15px; background-image: url('https://i.postimg.cc/gjS2LNtp/d036b4adf7918cd38c1b8f06523b7580.jpg'); background-size: cover; background-position: center; }
        .website-name { font-size: 26px; font-weight: 900; }
        .save-icon { width: 30px; height: 30px; cursor: pointer; }
        .save-icon path { fill: none; stroke: var(--text-color); stroke-width: 1.5; }
        .save-icon.saved path { fill: var(--primary-red); stroke: var(--primary-red); }
        .back-btn { display: inline-block; color: var(--text-color); text-decoration: none; font-size: 18px; padding: 20px 20px 0 20px; }
        .back-btn:before { content: '‹ '; font-size: 24px; }
        
        /* --- स्लाइडर के लिए नए स्टाइल --- */
        .slider-container { position: relative; width: 100%; aspect-ratio: 16 / 9; max-height: 768px; margin-bottom: 25px; overflow: hidden; background-color: #000; }
        .slider-track { position: relative; height: 100%; display: flex; }
        .hero-slide { position: relative; width: 100%; height: 100%; flex-shrink: 0; background-size: cover; background-position: center; display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-start; padding: 30px; cursor: grab; }
        .hero-slide::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(20, 20, 20, 0.9), transparent); }

        .hero-title { z-index: 2; font-size: 22px; font-weight: bold; text-shadow: 2px 2px 4px #000; text-align: left; }
        .watch-now-btn { z-index: 2; margin-top: 15px; padding: 10px 25px; background-color: var(--primary-red); color: var(--text-color); border: none; border-radius: 4px; font-size: 14px; font-weight: bold; display: inline-flex; align-items: center; gap: 25px; cursor: pointer; text-transform: uppercase; }
        .anime-row { margin-bottom: 20px; }
        .anime-row h2 { font-size: 18px; margin-bottom: 12px; padding: 0 20px; }
        .row-content { display: flex; overflow-x: auto; gap: 12px; padding: 0 20px 10px 20px; scrollbar-width: none; min-height: 185px; }
        .row-content::-webkit-scrollbar { display: none; }
        .anime-card { flex-shrink: 0; width: 110px; cursor: pointer; }
        .anime-card-poster { position: relative; width: 100%; height: 155px; }
        .anime-card img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; background-color: #333; }
        .language-tag { position: absolute; top: 6px; right: 6px; background-color: rgba(20, 20, 20, 0.8); padding: 3px 7px; border-radius: 4px; font-size: 11px; font-weight: bold; }
        .anime-card p { margin-top: 8px; font-size: 13px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #search-page .search-bar-container { padding: 15px 20px 25px 20px; }
        .search-input { width: 100%; padding: 14px 20px; background-color: #2c2c2c; border: 1px solid var(--primary-red); border-radius: 25px; color: var(--text-color); font-size: 16px; }
        .search-input::placeholder { color: #aaa; }
        #no-results { text-align: center; padding: 50px 20px; color: #888; }
        #search-results-wrapper, #saved-items-list { padding: 0 20px; }
        .search-result-item { display: flex; align-items: flex-start; margin-bottom: 20px; cursor: pointer; }
        .search-item-poster { position: relative; width: 100px; height: 145px; flex-shrink: 0; }
        .search-item-poster img { width: 100%; height: 100%; object-fit: cover; border-radius: 6px; }
        .search-item-info { padding-left: 15px; }
        .search-item-title { font-size: 17px; font-weight: bold; margin-bottom: 6px; }
        .search-item-desc { font-size: 13px; color: #ccc; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }
        .details-content-wrapper { padding: 20px; }
        .details-poster-container { max-width: 200px; margin: 0 auto 20px auto; }
        .details-poster { width: 100%; border-radius: 10px; }
        .details-info h1 { font-size: 28px; }
        .details-info p { margin-top: 10px; color: #ccc; line-height: 1.5; }
        .action-button-container { margin-top: 25px; }
        .watch-btn { display: block; width: 100%; padding: 12px 25px; background-color: var(--primary-red); color: var(--text-color); border: none; border-radius: 5px; font-size: 16px; font-weight: bold; text-align: center; cursor: pointer; }
        .download-btn-container { padding: 30px 20px; text-align: center; }
        .download-btn { display: inline-block; width: 100%; max-width: 350px; padding: 15px 25px; background-color: var(--primary-red); color: var(--text-color); border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background-color: #181818; display: flex; justify-content: space-around; padding: 8px 0; border-top: 1px solid #333; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #8e8e8e; text-decoration: none; font-size: 12px; cursor: pointer; }
        .nav-item.active { color: var(--text-color); }
        .nav-icon { width: 26px; height: 26px; margin-bottom: 3px; }
        .nav-icon path { fill: currentColor; }
    </style>
    
    <script type='text/javascript' src='//pl27699071.revenuecpmgate.com/f0/82/de/f082dee3a4c51c080fabf0b96fc62c16.js'></script>
    
</head>
<body>
    <header id="main-header"><div class="header-content"><div class="logo-group"><div class="logo-placeholder"></div><h1 class="website-name">Anime<span>Buzz</span></h1></div></div></header>
    <header id="secondary-header"><div class="header-content" id="secondary-header-content"></div></header>
    <div id="home-page" class="page active"><main><section id="banner-container" class="slider-container"><div id="slider-track" class="slider-track"></div></section><div id="home-rows"></div></main></div>
    <div id="search-page" class="page"><div class="search-bar-container"><input type="text" id="searchInput" class="search-input" placeholder="Search..." onkeyup="handleSearch()"></div><div id="search-results-wrapper"></div></div>
    <div id="saved-page" class="page"><div id="saved-items-list"></div></div>
    <div id="details-page" class="page"><a href="#" class="back-btn" onclick="event.preventDefault(); navigateBack()">Back</a><div class="details-content-wrapper"><div class="details-poster-container"><img src="" id="details-poster" class="details-poster"></div><div class="details-info"><h1 id="details-title"></h1><p id="details-desc"></p></div><div class="action-button-container"><button id="details-watch-btn" class="watch-btn" onclick="navigateTo('episodes-page')">Watch Now</button></div></div></div>
    <div id="episodes-page" class="page"><a href="#" class="back-btn" onclick="event.preventDefault(); navigateTo('details-page')">Back</a><div id="episodes-container"></div></div>
    <nav class="bottom-nav">
        <a id="nav-home" class="nav-item active" onclick="navigateTo('home-page')"><svg class="nav-icon" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg><span>Home</span></a>
        <a id="nav-search" class="nav-item" onclick="navigateTo('search-page')"><svg class="nav-icon" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"></path></svg><span>Search</span></a>
        <a id="nav-saved" class="nav-item" onclick="navigateTo('saved-page')"><svg class="nav-icon" viewBox="0 0 20 20"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path></svg><span>Saved</span></a>
    </nav>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyASOG_iJLTolJHK54Z4BpLpAimA4JALURY",
          authDomain: "animeweb-b9a7b.firebaseapp.com",
          projectId: "animeweb-b9a7b",
          storageBucket: "animeweb-b9a7b.firebasestorage.app",
          messagingSenderId: "920902736319",
          appId: "1:920902736319:web:b0dff9ec9e298021bf290a"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let pageHistory = ['home-page'];
        let savedItems = [];
        let allData = { anime: [], animeBanners: [] };
        let currentItemData = null;

        function navigateTo(pageId, data = null) {
            if (pageHistory[pageHistory.length - 1] !== pageId || data) {
                if (pageHistory[pageHistory.length - 1] !== pageId) pageHistory.push(pageId);
            }
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId)?.classList.add('active');

            if (pageId === 'details-page' && data) {
                currentItemData = data;
                document.getElementById('details-poster').src = data.imageUrl;
                document.getElementById('details-title').innerText = data.title;
                document.getElementById('details-desc').innerText = data.description || 'No description available.';
                document.getElementById('details-watch-btn').innerText = data.buttonText || 'Watch Now';
            }
            if (pageId === 'episodes-page') renderDownloadPage();
            if (pageId === 'saved-page') renderSavedItems();
            if (pageId === 'search-page' && allData.anime.length > 0) handleSearch(true);
            updateHeader(pageId);
            window.scrollTo(0, 0);
        }

        function createAnimeCard(item) {
            const langTag = item.language ? `<span class="language-tag">${item.language}</span>` : '';
            return `<div class="anime-card" onclick='navigateTo("details-page", ${JSON.stringify(item)})'>
                        <div class="anime-card-poster">
                            <img loading="lazy" src="${item.imageUrl}" alt="${item.title}">
                            ${langTag}
                        </div>
                        <p>${item.title}</p>
                    </div>`;
        }

        async function initializeApp() {
            savedItems = JSON.parse(localStorage.getItem('animeBuzzSaved')) || [];
            try {
                const [animeSnapshot, bannersSnapshot] = await Promise.all([
                    db.collection('anime').get(),
                    db.collection('animeBanners').get()
                ]);
                allData.anime = animeSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                allData.animeBanners = bannersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                renderBanners(allData.animeBanners);
                renderHomePage(allData.anime);
            } catch (err) { console.error("Error initializing app:", err); }
        }
        
        function renderBanners(banners) {
            const track = document.getElementById('slider-track');
            if (!track || banners.length === 0) return;

            const slidesHTML = banners.map(banner => {
                const buttonText = banner.buttonText || 'Watch Now';
                return `<div class="hero-slide" style="background-image: url('${banner.imageUrl}');" data-details='${JSON.stringify(banner)}'>
                            <h3 class="hero-title">${banner.title}</h3>
                            <button class="watch-now-btn"><span>${buttonText}</span><span>&gt;</span></button>
                        </div>`;
            }).join('');
            
            track.innerHTML = slidesHTML;
            initSlider();
        }

        function renderHomePage(animeList) {
            const container = document.getElementById("home-rows");
            const categories = animeList.reduce((acc, anime) => {
                const category = anime.category || "Trending";
                if (!acc[category]) acc[category] = [];
                acc[category].push(anime);
                return acc;
            }, {});
            let html = "";
            for (const category in categories) {
                html += `<section class="anime-row"><h2>${category}</h2><div class="row-content">${categories[category].map(createAnimeCard).join('')}</div></section>`;
            }
            container.innerHTML = html;
        }
        
        function createSearchResultItem(item) {
            const langTag = item.language ? `<span class="language-tag">${item.language}</span>` : '';
            const desc = item.description || 'No description available.';
            return `
                <div class="search-result-item" onclick='navigateTo("details-page", ${JSON.stringify(item)})'>
                    <div class="search-item-poster">
                        <img loading="lazy" src="${item.imageUrl}" alt="${item.title}">
                        ${langTag}
                    </div>
                    <div class="search-item-info">
                        <div class="search-item-title">${item.title}</div>
                        <div class="search-item-desc">${desc}</div>
                    </div>
                </div>`;
        }
        
        function handleSearch(showAll = false) {
            const term = document.getElementById("searchInput").value.toLowerCase();
            const resultsWrapper = document.getElementById("search-results-wrapper");
            
            if (showAll && !term) {
                resultsWrapper.innerHTML = allData.anime.map(createSearchResultItem).join('');
                return;
            }

            const filteredAnime = allData.anime.filter(e => e.title.toLowerCase().includes(term));
            
            if (filteredAnime.length > 0) {
                resultsWrapper.innerHTML = filteredAnime.map(createSearchResultItem).join('');
            } else {
                resultsWrapper.innerHTML = `<div id="no-results"><p>No results found</p></div>`;
            }
        }
        
        function renderDownloadPage(){
            const container = document.getElementById("episodes-container");
            if (currentItemData && currentItemData.episodeLink) {
                container.innerHTML = `<div class="download-btn-container"><button class="download-btn" onclick="openExternalLink('${currentItemData.episodeLink}')">Download file</button></div>`;
            } else {
                container.innerHTML = '<p style="padding: 20px;">Download link not available.</p>';
            }
        }
        
        function navigateBack() { if (pageHistory.length > 1) { pageHistory.pop(); navigateTo(pageHistory[pageHistory.length - 1]); } }
        function updateHeader(pageId){const pageHeaders={"search-page":"Search","saved-page":"My List","details-page":"Details","episodes-page":"Episodes"},title=pageHeaders[pageId],mainHeader=document.getElementById("main-header"),secondaryHeader=document.getElementById("secondary-header"),headerContentEl=document.getElementById("secondary-header-content");if(title){mainHeader.style.display="none",secondaryHeader.style.display="block";let headerContent=`<h1 class="website-name">${title}</h1>`;"details-page"===pageId&&currentItemData&&(headerContent+=`<svg class="save-icon ${savedItems.some(i=>i.id===currentItemData.id)?"saved":""}" onclick="toggleSave(this,'${currentItemData.id}','${currentItemData.title}','${currentItemData.imageUrl}')" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`),headerContentEl.innerHTML=headerContent}else mainHeader.style.display="block",secondaryHeader.style.display="none";document.querySelectorAll(".nav-item").forEach(item=>item.classList.remove("active"));const navId=`nav-${pageId.split("-")[0]}`;document.getElementById(navId)?.classList.add("active")}
        function toggleSave(icon,id,title,imageUrl,description){const isSaved=icon.classList.toggle("saved"),item={id,title,imageUrl,description};isSaved?savedItems.some(i=>i.id===id)||savedItems.push(item):savedItems=savedItems.filter(i=>i.id!==id),localStorage.setItem("animeBuzzSaved",JSON.stringify(savedItems))}
        
        function renderSavedItems(){
            const listContainer = document.getElementById("saved-items-list");
            if (savedItems.length > 0) {
                 const fullSavedItems = savedItems.map(savedItem => {
                    return allData.anime.find(anime => anime.id === savedItem.id) || 
                           allData.animeBanners.find(banner => banner.id === savedItem.id) || 
                           savedItem;
                });
                listContainer.innerHTML = fullSavedItems.map(createSearchResultItem).join('');
            } else {
                listContainer.innerHTML = `<div id="no-results"><p>Nothing saved yet.</p></div>`;
            }
        }

        function openExternalLink(url){if(url&&url.startsWith("https"))window.open(url,"_blank");else alert("Invalid URL.")}
        
        // === YAHAN SLIDER FUNCTION KO PURI TARAH SE BADLA GAYA HAI ===
        function initSlider() {
            const track = document.getElementById('slider-track');
            const container = document.getElementById('banner-container');
            if (!track || !container || track.children.length <= 1) return;

            const slides = Array.from(track.children);
            const slideCount = slides.length;
            
            // Clone slides for infinite loop
            const firstClone = slides[0].cloneNode(true);
            const lastClone = slides[slideCount - 1].cloneNode(true);
            track.appendChild(firstClone);
            track.insertBefore(lastClone, slides[0]);

            let currentIndex = 1;
            let startX = 0;
            let currentTranslate = 0;
            let prevTranslate = 0;
            let isDragging = false;
            let animationID;
            let autoSlideTimer;

            const setPositionByIndex = () => {
                currentTranslate = currentIndex * -container.offsetWidth;
                prevTranslate = currentTranslate;
                track.style.transform = `translateX(${currentTranslate}px)`;
            };

            const getPositionX = (event) => event.touches ? event.touches[0].clientX : event.pageX;

            const animation = () => {
                track.style.transform = `translateX(${currentTranslate}px)`;
                if (isDragging) requestAnimationFrame(animation);
            };

            const touchStart = (event) => {
                clearInterval(autoSlideTimer);
                isDragging = true;
                startX = getPositionX(event);
                animationID = requestAnimationFrame(animation);
                track.style.transition = 'none';
            };

            const touchMove = (event) => {
                if (isDragging) {
                    const currentX = getPositionX(event);
                    currentTranslate = prevTranslate + currentX - startX;
                }
            };

            const touchEnd = () => {
                isDragging = false;
                cancelAnimationFrame(animationID);
                const movedBy = currentTranslate - prevTranslate;

                if (movedBy < -100) currentIndex++;
                if (movedBy > 100) currentIndex--;
                
                track.style.transition = 'transform 0.5s ease-out';
                setPositionByIndex();
                startAutoSlide();
            };

            const checkIndex = () => {
                if (currentIndex === 0) {
                    track.style.transition = 'none';
                    currentIndex = slideCount;
                    setPositionByIndex();
                }
                if (currentIndex === slideCount + 1) {
                    track.style.transition = 'none';
                    currentIndex = 1;
                    setPositionByIndex();
                }
            };
            
            const startAutoSlide = () => {
                clearInterval(autoSlideTimer);
                autoSlideTimer = setInterval(() => {
                    currentIndex++;
                    track.style.transition = 'transform 0.5s ease-out';
                    setPositionByIndex();
                }, 3000);
            };

            track.addEventListener('transitionend', checkIndex);
            
            // Click/Tap Navigation
            track.addEventListener('click', (e) => {
                // Prevent navigation if swipe was more than a few pixels
                if (Math.abs(currentTranslate - prevTranslate) > 5) return;
                
                const slide = e.target.closest('.hero-slide');
                if (slide) {
                    const data = JSON.parse(slide.dataset.details);
                    navigateTo("details-page", data);
                }
            }, true);

            // Add all event listeners
            container.addEventListener('touchstart', touchStart, { passive: true });
            container.addEventListener('touchend', touchEnd);
            container.addEventListener('touchmove', touchMove, { passive: true });
            container.addEventListener('mousedown', touchStart);
            container.addEventListener('mouseup', touchEnd);
            container.addEventListener('mouseleave', () => { if (isDragging) touchEnd(); });
            container.addEventListener('mousemove', touchMove);
            window.addEventListener('resize', setPositionByIndex);

            setPositionByIndex();
            startAutoSlide();
        }
        
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
    </html>
